<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Toad Battle Arena</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=DotGothic16&display=swap" rel="stylesheet">
<style>
/* Desktop Layout Improvements */
:root{
  --bg1:#2D1B69; --bg2:#11998E; --bg3:#38EF7D;
  --panel:#0f0f0f; --accent:#38EF7D; --danger:#ff4444;
}

html,body{
  height:100%;
  margin:0;
  font-family:'Press Start 2P','DotGothic16',monospace;
  background:linear-gradient(135deg,var(--bg1),var(--bg2),var(--bg3));
  color:#fff;
  overflow:hidden;
}

.wrap{
  position:relative;
  width:100%;
  height:100%;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:flex-start;
  padding:14px;
  box-sizing:border-box;
  max-width: none; /* Remove max-width constraint */
}

.header{
  width:100%;
  text-align:center;
  margin-bottom:12px;
  z-index:5;
}

.title{
  color:var(--accent);
  font-size:22px; /* Larger title */
  text-shadow:0 0 8px rgba(0,0,0,.6);
}

/* Main game container with integrated log */
.game-container {
  display: flex;
  width: 100%;
  height: calc(100vh - 120px); /* Account for header and controls */
  gap: 16px;
  max-width: none;
}

.arena{
  position:relative;
  flex:1;
  display:flex;
  flex-direction:column;
  gap:16px; /* Larger gaps */
  align-items:center;
  justify-content:space-between;
  padding:16px;
  box-sizing:border-box;
  background: rgba(0,0,0,0.2); /* Subtle background */
  border-radius: 12px;
  border: 2px solid rgba(255,255,255,0.1);
}

/* Larger battlefield areas */
.area{
  width:100%;
  display:flex;
  align-items:center;
  justify-content:space-between;
  background:rgba(0,0,0,0.45);
  border:3px solid #fff;
  padding:20px; /* More padding */
  border-radius:12px;
  min-height: 200px; /* Ensure minimum height */
}

.player-info{
  display:flex;
  flex-direction:column;
  align-items:center;
  min-width:180px; /* Wider player info */
}

.name{
  color:var(--accent);
  font-size:14px; /* Larger text */
  margin-bottom:8px;
}

.hp-bar{
  width:180px; /* Wider HP bar */
  height:24px; /* Taller HP bar */
  background:#111;
  border:2px solid #fff;
  border-radius:8px;
  overflow:hidden;
  display:flex;
  align-items:center;
  justify-content:center;
}

.hp-segments{
  display:flex;
  width:92%;
  gap:2px;
}

.seg{
  flex:1;
  height:18px; /* Taller segments */
  background:#fff;
  border-radius:2px;
  opacity:1;
  box-sizing:border-box;
  position:relative;
}

/* Larger battlefield slots */
.slots{
  display:flex;
  gap:14px; /* More spacing */
  align-items:center;
  justify-content:center;
}

.slot{
  width:110px; /* Larger slots */
  height:150px; /* Taller slots */
  border:2px dashed rgba(255,255,255,0.25);
  border-radius:10px;
  background:rgba(0,0,0,0.25);
  display:flex;
  align-items:center;
  justify-content:center;
  position:relative;
}

.card-container{display:flex;flex-direction:column;align-items:center;gap:4px}
.card-hp-bar{width:86px;height:14px;background:#111;border:2px solid #fff;border-radius:6px;display:flex;align-items:center;justify-content:center;overflow:hidden}
.card-hp-segments{display:flex;width:92%;gap:2px}
.card-hp-seg{flex:1;height:10px;background:#fff;border-radius:2px;opacity:1;position:relative}
.card-hp-seg.half::after{content:'';position:absolute;left:0;top:0;bottom:0;width:50%;background:#111}
.card .stats{display:none!important}

/* Larger hand area */
.hand{
  display:flex;
  gap:12px; /* More spacing */
  flex-wrap:wrap;
  justify-content:center;
  align-items:center;
  flex:1;
  min-height:160px; /* Taller hand area */
}

/* Integrated log panel */
.log{
  width: 300px; /* Wider log */
  height: 100%;
  background: rgba(0,0,0,0.8);
  border: 2px solid #fff;
  border-radius: 12px;
  padding: 12px;
  overflow-y: auto;
  font-size: 11px;
  z-index: 60;
  display: flex;
  flex-direction: column;
}

.log .entry{
  margin-bottom: 8px;
  line-height: 1.4;
}

.log .player{
  color: var(--accent);
}

.log .computer{
  color: var(--danger);
}

/* Turn indicator - larger */
.turn-indicator{
  position:fixed;
  top:24px;
  left:50%;
  transform:translateX(-50%);
  background:rgba(0,0,0,0.9);
  border:2px solid var(--accent);
  padding:12px 20px; /* Larger padding */
  border-radius:8px;
  font-size:14px; /* Larger text */
  z-index:60;
  box-shadow: 0 4px 8px rgba(0,0,0,0.3);
}

/* Turn control panel - larger */
.turn-panel{
  position:fixed;
  left:50%;
  transform:translateX(-50%);
  bottom:24px;
  display:flex;
  gap:16px;
  z-index:50;
}

.btn{
  background:#fff;
  color:#000;
  border:2px solid #000;
  padding:12px 20px; /* Larger buttons */
  font-family:'Press Start 2P',monospace;
  font-size:12px; /* Larger text */
  cursor:pointer;
  border-radius: 6px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

.btn:hover {
  background: var(--accent);
  color: #000;
}

.btn:active{
  transform:scale(.98);
}

.btn.disabled{
  background:#666;
  color:#333;
  cursor:not-allowed;
}

/* Action panel adjustments */
.card-action-panel{
  position:absolute;
  z-index:100;
  background:rgba(0,0,0,0.95);
  border:2px solid var(--accent);
  border-radius:8px;
  padding:12px; /* More padding */
  display:flex;
  gap:10px;
  flex-direction:column;
  min-width:140px; /* Wider panel */
  box-shadow: 0 4px 12px rgba(0,0,0,0.4);
}

.card-action-panel .btn{
  background:#fff;
  color:#000;
  border:2px solid #000;
  padding:8px 14px; /* Larger action buttons */
  font-family:'Press Start 2P',monospace;
  font-size:10px;
  cursor:pointer;
  text-align:center;
  border-radius: 4px;
}

/* Common styles */
:root{
  --bg1:#2D1B69; --bg2:#11998E; --bg3:#38EF7D;
  --panel:#0f0f0f; --accent:#38EF7D; --danger:#ff4444;
}

html,body{height:100%;margin:0;font-family:'Press Start 2P','DotGothic16',monospace;background:linear-gradient(135deg,var(--bg1),var(--bg2),var(--bg3));color:#fff;overflow:hidden}
.wrap{position:relative;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;padding=14px;box-sizing:border-box}
.header{width:100%;text-align:center;margin-bottom:8px;z-index:5}
.title{color:var(--accent);font-size:18px;text-shadow:0 0 6px rgba(0,0,0,.6)}
.arena{position:relative;flex:1;width:100%;max-width:1100px;display:flex;flex-direction:column;gap:12px;align-items:center;justify-content:space-between;padding:12px;box-sizing:border-box}
 /* top area (computer) */
.area{width:100%;display:flex;align-items:center;justify-content:space-between;background:rgba(0,0,0,0.45);border:3px solid #fff;padding:12px;border-radius:8px}
.player-info{display:flex;flex-direction:column;align-items:center;min-width:160px}
.name{color:var(--accent);font-size:12px;margin-bottom:6px}
.hp-bar{width:160px;height:20px;background:#111;border:2px solid #fff;border-radius:6px;overflow:hidden;display:flex;align-items:center;justify-content:center}
.hp-segments{display:flex;width:92%;gap:2px}
.seg{flex:1;height:14px;background:#fff;border-radius:2px;opacity:1;box-sizing:border-box;position:relative}
.seg.half::after{content:'';position:absolute;left:0;top:0;bottom:0;width:50%;background:#111}
.hand{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;align-items:center;flex:1;min-height:140px}
/* battlefield slots */
.slots{display:flex;gap:10px;align-items:center;justify-content:center}
.slot{width:90px;height:130px;border:2px dashed rgba(255,255,255,0.25);border-radius:8px;background:rgba(0,0,0,0.25);display:flex;align-items:center;justify-content:center;position:relative}
.slot.occupied{border-style:solid}
.slot .card{width:86px;height:120px;border:3px solid #fff;border-radius:6px;background:#222;overflow:hidden;cursor:pointer;display:flex;flex-direction:column;transition:opacity 0.3s ease}
.card img{width:100%;height:72%;object-fit:cover;display:block}
.card .stats{height:28%;background:rgba(0,0,0,0.9);padding:4px;box-sizing:border-box;font-size:10px;text-align:center}
.card.selected{outline:3px solid var(--accent);transform:translateY(-6px)}
.card.used{opacity:0.4;filter:grayscale(0.7)}
.card.used::after{content:'USED';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.8);color:#fff;padding:2px 6px;font-size:8px;border-radius:3px;pointer-events:none}
 /* action panel - now positioned relative to selected card */
.card-action-panel{position:absolute;z-index:100;background:rgba(0,0,0,0.9);border:2px solid var(--accent);border-radius:6px;padding:8px;display:flex;gap:8px;flex-direction:column;min-width:120px}
.card-action-panel .btn{background:#fff;color:#000;border:2px solid #000;padding:6px 12px;font-family:'Press Start 2P',monospace;font-size:9px;cursor:pointer;text-align:center}
.card-action-panel .btn:hover{background:var(--accent);color:#000}
.card-action-panel .btn:active{transform:scale(.98)}
.card-action-panel .btn.disabled{background:#666;color:#333;cursor:not-allowed}
 /* turn control panel */
.turn-panel{position:fixed;left:50%;transform:translateX(-50%);bottom=22px;display:flex;gap:12px;z-index:50}
.btn{background:#fff;color:#000;border:2px solid #000;padding:10px 16px;font-family:'Press Start 2P',monospace;font-size:11px;cursor:pointer}
.btn:active{transform:scale(.98)}
.btn.disabled{background:#666;color:#333;cursor:not-allowed}
 /* turn indicator */
.turn-indicator{position:fixed;top:20px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,0.8);border:2px solid var(--accent);padding:8px 16px;border-radius:6px;font-size:12px;z-index=60}
 /* attack animations */
.attacking-forward{animation:attackForward 1000ms ease-in-out forwards; z-index: 1000;}
@keyframes attackForward{
  0%{transform:translateY(0) scale(1) rotateZ(0deg)}
  25%{transform:translateY(80px) scale(1.2) rotateZ(5deg)}
  50%{transform:translateY(160px) scale(1.3) rotateZ(-3deg)}
  75%{transform:translateY(200px) scale(1.1) rotateZ(2deg)}
  100%{transform:translateY(0) scale(1) rotateZ(0deg)}
}

.attacking-backward{animation:attackBackward 1000ms ease-in-out forwards; z-index: 1000;}
@keyframes attackBackward{
  0%{transform:translateY(0) scale(1) rotateZ(0deg)}
  25%{transform:translateY(-80px) scale(1.2) rotateZ(-5deg)}
  50%{transform:translateY(-160px) scale(1.3) rotateZ(3deg)}
  75%{transform:translateY(-200px) scale(1.1) rotateZ(-2deg)}
  100%{transform:translateY(0) scale(1) rotateZ(0deg)}
}

/* flying projectile animation */
.flying-attack{animation:flyToTarget 800ms ease-in-out forwards; z-index: 2000; position: absolute;}
@keyframes flyToTarget{
  0%{transform:translate(0, 0) scale(1) rotateZ(0deg); opacity: 1;}
  50%{transform:translate(var(--target-x), var(--target-y)) scale(1.2) rotateZ(180deg); opacity: 0.8;}
  100%{transform:translate(var(--target-x), var(--target-y)) scale(0.8) rotateZ(360deg); opacity: 0;}
}

/* defend animation */
.defending-anim{animation:defendPulse 600ms ease-in-out forwards}
@keyframes defendPulse{
  0%{transform:scale(1);box-shadow:0 0 0 rgba(56,239,125,0.8)}
  50%{transform:scale(1.08);box-shadow:0 0 20px rgba(56,239,125,0.8)}
  100%{transform:scale(1);box-shadow:0 0 10px rgba(56,239,125,0.6)}
}

/* damage popup */
.dmg-pop{position:absolute;font-size:16px;font-weight:700;color:#ff4444;pointer-events:none;animation:damageFloat 1000ms ease-out forwards;z-index:200;text-shadow:2px 2px 0 #000}
@keyframes damageFloat{
  0%{transform:translateY(0) translateX(-50%) scale(0.8);opacity:0}
  20%{transform:translateY(-10px) translateX(-50%) scale(1.2);opacity:1}
  60%{transform:translateY(-40px) translateX(-50%) scale(1);opacity:1}
  100%{transform:translateY(-70px) translateX(-50%) scale(0.8);opacity:0}
}

/* hit effects */
.hit{animation:hitShake 400ms ease-out forwards}
@keyframes hitShake{
  0%{transform:translateX(0)}
  10%{transform:translateX(-8px) rotateZ(-2deg)}
  20%{transform:translateX(6px) rotateZ(1deg)}
  30%{transform:translateX(-4px) rotateZ(-1deg)}
  40%{transform:translateX(3px) rotateZ(0.5deg)}
  50%{transform:translateX(-2px) rotateZ(-0.5deg)}
  60%{transform:translateX(1px) rotateZ(0.2deg)}
  100%{transform:translateX(0) rotateZ(0deg)}
}

.flash{animation:flashHit 300ms ease-out forwards}
@keyframes flashHit{
  0%{filter:brightness(1) contrast(1)}
  25%{filter:brightness(1.8) contrast(1.3) saturate(0)}
  50%{filter:brightness(1.5) contrast(1.2) saturate(0.2)}
  75%{filter:brightness(1.3) contrast(1.1) saturate(0.6)}
  100%{filter:brightness(1) contrast(1) saturate(1)}
}

.die{animation:dieFade 600ms ease forwards}
@keyframes dieFade{0%{opacity:1;transform:scale(1) rotateZ(0deg)}100%{opacity:0;transform:scale(0.3) rotateZ(15deg)}}
/* log */
.log{position:fixed;right:14px;top:70px;width:250px;height:340px;background:rgba(0,0,0,.6);border:2px solid #fff;padding:8px;overflow:auto;font-size:11px;z-index:60}
.log .entry{margin-bottom:6px}
.log .player{color:var(--accent)}
.log .computer{color:var(--danger)}
/* small responsive */
@media (max-width:900px){
  .area{flex-direction:column;gap:8px}
  .player-info{min-width:140px}
  .slots{flex-wrap:wrap}
}

/* Hide game-container layout on mobile */
@media (max-width: 768px) {
  .game-container {
    display: block !important;
    height: auto !important;
  }
  
  .arena {
    background: none !important;
    border: none !important;
  }
  
  /* Your existing mobile styles continue to work here */
  /* ... all your existing mobile CSS ... */
}

/* Status effect icons - positioned above slot containers */
.status-icon {
  position: absolute;
  top: -15px; /* Above the slot container */
  right: 8px;
  width: 22px;
  height: 22px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  font-weight: bold;
  border: 2px solid #fff;
  z-index: 150;
  animation: statusPulse 2s ease-in-out infinite;
  box-shadow: 0 2px 4px rgba(0,0,0,0.5);
}

.status-icon.poison {
  background: #8B4513;
  color: #fff;
}

.status-icon.stun {
  background: #FFD700;
  color: #000;
}

.status-icon.sleep {
  background: #4169E1;
  color: #fff;
}

.status-icon.weaken {
  background: #800080;
  color: #fff;
}
/* Cooldown effect styling */
.status-icon.cooldown {
  background: #666;
  color: #ccc;
  border: 2px solid #999;
}

.card-action-panel .btn.cooldown {
  background: #444;
  color: #888;
  cursor: not-allowed;
  position: relative;
}

.card-action-panel .btn.cooldown::after {
  content: 'CD: ' attr(data-cooldown);
  position: absolute;
  top: -18px;
  right: -5px;
  background: #ff4444;
  color: #fff;
  font-size: 7px;
  padding: 1px 4px;
  border-radius: 3px;
  pointer-events: none;
}

@keyframes statusPulse {
  0%, 100% { transform: scale(1); opacity: 0.9; }
  50% { transform: scale(1.1); opacity: 1; }
}

/* Animated status effect popup */
.status-effect-popup {
  position: absolute;
  font-size: 20px;
  font-weight: 700;
  pointer-events: none;
  animation: statusEffectFloat 1500ms ease-out forwards;
  z-index: 250;
  text-shadow: 2px 2px 0 #000;
  left: 50%;
  top: 20%;
}

@keyframes statusEffectFloat {
  0% { transform: translateY(0) translateX(-50%) scale(0.5); opacity: 0; }
  15% { transform: translateY(-15px) translateX(-50%) scale(1.3); opacity: 1; }
  30% { transform: translateY(-25px) translateX(-50%) scale(1.1); opacity: 1; }
  70% { transform: translateY(-45px) translateX(-50%) scale(1); opacity: 0.8; }
  100% { transform: translateY(-60px) translateX(-50%) scale(0.8); opacity: 0; }
}

/* Multiple status icons positioning - horizontally above slot */
.status-icon:nth-child(n+2) { 
  right: calc(8px + (var(--icon-index) * 26px)); 
}

/* Poison damage overlay animation */
.poison-damage-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: radial-gradient(circle, rgba(139, 69, 19, 0.7) 0%, rgba(139, 69, 19, 0.3) 50%, transparent 100%);
  border-radius: 6px;
  pointer-events: none;
  z-index: 300;
  animation: poisonPulse 1500ms ease-in-out forwards;
}

@keyframes poisonPulse {
  0% { 
    opacity: 0; 
    transform: scale(0.8); 
    background: radial-gradient(circle, rgba(139, 69, 19, 0.9) 0%, rgba(139, 69, 19, 0.5) 50%, transparent 100%);
  }
  25% { 
    opacity: 1; 
    transform: scale(1.05); 
    background: radial-gradient(circle, rgba(139, 69, 19, 0.8) 0%, rgba(139, 69, 19, 0.4) 50%, transparent 100%);
  }
  50% { 
    opacity: 0.8; 
    transform: scale(1); 
    background: radial-gradient(circle, rgba(139, 69, 19, 0.7) 0%, rgba(139, 69, 19, 0.3) 50%, transparent 100%);
  }
  75% { 
    opacity: 0.6; 
    transform: scale(0.95); 
    background: radial-gradient(circle, rgba(139, 69, 19, 0.5) 0%, rgba(139, 69, 19, 0.2) 50%, transparent 100%);
  }
  100% { 
    opacity: 0; 
    transform: scale(0.9); 
    background: radial-gradient(circle, rgba(139, 69, 19, 0.3) 0%, rgba(139, 69, 19, 0.1) 50%, transparent 100%);
  }
}
/* Desktop version remains unchanged above this point */

/* Mobile-specific overrides - only apply on mobile devices */
@media (max-width: 768px) {
  /* Allow scrolling on mobile */
  html, body { 
    overflow-y: auto !important; 
    overflow-x: hidden !important; 
  }
  
  /* Compact layout for mobile */
  .wrap { 
    padding: 8px !important; 
    height: auto !important; 
    min-height: 100vh !important;
  }
  
  .title { font-size: 14px !important; }
  
  .turn-indicator { 
    top: 10px !important; 
    font-size: 10px !important; 
    padding: 6px 12px !important;
  }
  
  .arena { 
    gap: 8px !important; 
    padding: 8px !important;
    flex: none !important;
  }
  
  /* Mobile area layout */
  .area { 
    flex-direction: column !important; 
    gap: 8px !important; 
    padding: 8px !important;
  }
  
  .player-info { 
    min-width: 120px !important; 
    order: -1 !important;
  }
  
  .name { font-size: 11px !important; }
  
  .hp-bar { 
    width: 120px !important; 
    height: 16px !important;
  }
  
  .hp-segments { width: 90% !important; gap: 1px !important; }
  .seg { height: 12px !important; }
  
  /* Mobile slots */
  .slots { 
    flex-wrap: wrap !important; 
    gap: 6px !important; 
    justify-content: center !important;
  }
  
  .slot { 
    width: 60px !important; 
    height: 85px !important;
  }
  
  .slot .card { 
    width: 56px !important; 
    height: 78px !important;
  }
  
  .card .stats { 
    font-size: 7px !important; 
    padding: 2px !important;
  }
  
  /* Mobile hand */
  .hand { 
    min-height: 90px !important; 
    gap: 6px !important;
    order: 1 !important;
  }
  
  /* Mobile turn panel */
  .turn-panel { 
    bottom: 10px !important; 
    gap: 8px !important;
  }
  
  .btn { 
    padding: 8px 12px !important; 
    font-size: 9px !important;
  }
  
  /* Mobile action panel - bottom center */
  .card-action-panel { 
    position: fixed !important;
    bottom: 60px !important;
    left: 50% !important;
    transform: translateX(-50%) !important;
    top: auto !important;
    right: auto !important;
    max-width: 280px !important;
    min-width: 200px !important;
  }
  
  .card-action-panel .btn { 
    font-size: 8px !important; 
    padding: 4px 8px !important;
  }
  
  /* Mobile status icons */
  .status-icon { 
    width: 16px !important; 
    height: 16px !important; 
    font-size: 10px !important;
    top: -12px !important;
  }
  
  /* Mobile log - bottom overlay instead of right side */
  .log { 
    position: fixed !important;
    bottom: 0 !important;
    right: 0 !important;
    left: 0 !important;
    top: auto !important;
    width: 100% !important;
    height: 120px !important;
    background: rgba(0,0,0,0.9) !important;
    border: none !important;
    border-top: 2px solid #fff !important;
    padding: 6px !important;
    font-size: 9px !important;
    z-index: 40 !important;
    border-radius: 0 !important;
    overflow-y: auto !important;
  }
  
  .log .entry { 
    margin-bottom: 3px !important; 
    line-height: 1.2 !important;
  }
  
  /* Adjust panels to not overlap mobile log */
  .turn-panel { 
    bottom: 130px !important;
  }
  
  .card-action-panel { 
    bottom: 140px !important;
  }
}

/* Mobile card sizing fixes */
@media (max-width: 768px) {
  /* Mobile hand cards - smaller by default */
  .hand .card { 
    width: 45px !important; 
    height: 62px !important;
    transition: all 0.3s ease !important;
  }
  
  /* Enlarge hand cards when selected */
  .hand .card.selected { 
    width: 60px !important; 
    height: 85px !important;
    transform: translateY(-8px) scale(1.1) !important;
    z-index: 200 !important;
  }
  
  /* Larger battlefield slots for better visibility */
  .slot { 
    width: 75px !important; 
    height: 105px !important;
  }
  
  /* Larger battlefield cards */
  .slot .card { 
    width: 70px !important; 
    height: 98px !important;
  }
  
  /* Adjust card stats text for battlefield cards */
  .slot .card .stats { 
    font-size: 8px !important; 
    padding: 3px !important;
  }
  
  /* Keep hand card stats small */
  .hand .card .stats { 
    font-size: 6px !important; 
    padding: 2px !important;
  }
  
  /* Selected hand card gets readable text */
  .hand .card.selected .stats { 
    font-size: 7px !important; 
    padding: 2px !important;
  }
  
  /* Mobile status icons positioned for larger slots */
  .status-icon { 
    width: 18px !important; 
    height: 18px !important; 
    font-size: 11px !important;
    top: -14px !important;
  }
}

/* Very small mobile screens - even more compact hand cards */
@media (max-width: 480px) {
  /* Extra small hand cards */
  .hand .card { 
    width: 38px !important; 
    height: 54px !important;
  }
  
  /* Selected hand card enlarges more */
  .hand .card.selected { 
    width: 55px !important; 
    height: 78px !important;
  }
  
  /* Battlefield slots stay readable */
  .slot { 
    width: 65px !important; 
    height: 92px !important;
  }
  
  .slot .card { 
    width: 60px !important; 
    height: 85px !important;
  }
}

/* Touch and hold expansion for hand cards */
@media (max-width: 768px) {
  /* ... your existing mobile styles ... */
  
  /* Touch and hold expansion */
  .hand .card.touch-expanded {
    position: fixed !important;
    top: 50% !important;
    left: 50% !important;
    transform: translate(-50%, -50%) scale(1.5) !important;
    width: 86px !important;
    height: 120px !important;
    z-index: 1000 !important;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.8) !important;
    border: 3px solid var(--accent) !important;
    transition: all 0.3s ease !important;
  }
  
  /* Expanded card gets full-size readable text */
  .hand .card.touch-expanded .stats {
    font-size: 10px !important;
    padding: 4px !important;
  }
  
  /* Backdrop for expanded card */
  .touch-backdrop {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.7);
    z-index: 999;
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  
  .touch-backdrop.show {
    opacity: 1;
  }
}

/* Very small screens - even bigger expansion */
@media (max-width: 480px) {
  .hand .card.touch-expanded {
    transform: translate(-50%, -50%) scale(1.8) !important;
  }
}

/* Discard + per-card HP bars */
.discard-piles{display:flex;flex-direction:column;gap:6px;margin-top:8px;font-size:10px}
.discard-pile{background:rgba(0,0,0,0.45);border:2px solid #fff;border-radius:8px;padding:4px 8px;min-width:110px;text-align:center}
.discard-pile span{color:var(--accent)}

.card-container{display:flex;flex-direction:column;align-items:center;gap:4px}
.card-hp-bar{width:86px;height:14px;background:#111;border:2px solid #fff;border-radius:6px;display:flex;align-items:center;justify-content:center;overflow:hidden}
.card-hp-segments{display:flex;width:92%;gap:2px}
.card-hp-seg{flex:1;height:10px;background:#fff;border-radius:2px;opacity:1;position:relative}
.card-hp-seg.half::after{content:'';position:absolute;left:0;top:0;bottom:0;width:50%;background:#111}

/* Remove in‑card overlay text */
.card .stats{display:none!important}

/* NOTE: JS that was accidentally embedded in <style> moved into <script> */
</style>
</head>
<body>
  <div class="wrap">
    <div class="header"><div class="title">TOAD BATTLE ARENA</div></div>
    
    <div class="turn-indicator" id="turnIndicator">Player Turn</div>

    <!-- New integrated layout container -->
    <div class="game-container">
      <div class="arena" id="arena">
        <!-- COMPUTER AREA -->
        <div class="area" id="computerArea">
          <div class="player-info">
            <div class="name">Computer</div>
            <div class="hp-bar" title="Computer total HP">
              <div class="hp-segments" id="computerGlobalHP"></div>
            </div>
            <div class="discard-piles">
              <div class="discard-pile" id="computerDiscardPile">Discard: <span id="computerDiscardCount">0</span></div>
            </div>
            <div style="height:6px"></div>
          </div>

          <div class="slots" id="computerSlots">
            <!-- 5 slots -->
          </div>

          <div class="hand" id="computerHand">
            <!-- computer reserve cards (small) -->
          </div>
        </div>

        <!-- PLAYER AREA -->
        <div class="area" id="playerArea">
          <div class="player-info">
            <div class="name">Player</div>
            <div class="hp-bar" title="Player total HP">
              <div class="hp-segments" id="playerGlobalHP"></div>
            </div>
            <div class="discard-piles">
              <div class="discard-pile" id="playerDiscardPile">Discard: <span id="playerDiscardCount">0</span></div>
            </div>
            <div style="height:6px"></div>
          </div>

          <div class="slots" id="playerSlots">
            <!-- 5 slots -->
          </div>

          <div class="hand" id="playerHand" style="margin-left:12px">
            <!-- player hand cards (click to place on slots) -->
          </div>
        </div>
      </div>  <!-- Close arena div -->

      <!-- Integrated log panel -->
      <div class="log" id="battleLog">
        <div class="entry system">Battle ready – place cards to begin.</div>
      </div>
    </div  <!-- Close game-container div -->

    <!-- turn control panel -->
    <div class="turn-panel" id="turnPanel">
      <div class="btn" id="endTurnBtn">END TURN</div>
    </div>
  </div  <!-- Close wrap div -->

<!-- Removed external duplicate discard pile to avoid duplicate IDs -->
<script>
(function(){
  /* ===== ORIGINAL CONFIG ===== */
  const MAX_SLOTS=5; const MAX_HP=80; const SEGMENTS=8;
  const cardPool=[
    {src:"images/cards/the stranger card format.jpg",name:"The Stranger",hp:80,attacks:[{name:"Hidden Strike",damage:10,type:"physical",effect:"stun",duration:1,description:"Fast slice hits your opponent for 10 points. Stun 1 turn."}]},
    {src:"images/cards/horny toad card format.jpg",name:"Horny Toad",hp:80,attacks:[{name:"Piercing Strike",damage:20,type:"physical",description:"Devastating 20 damage."}]},
    {src:"images/cards/hypno toad card format.jpg",name:"Hypno Toad",hp:80,attacks:[{name:"Hypnotize",damage:0,type:"mental",effect:"sleep",duration:2,description:"Sleep 2 turns."},{name:"Poison Dart",damage:3,type:"poison",effect:"poison",duration:5,description:"3 dmg + poison (5x5)."}]},
    {src:"images/cards/sumo toad card format.jpg",name:"Sumo Toad",hp:80,attacks:[{name:"Oshidashi",damage:10,type:"physical",effect:"weaken",duration:1,description:"10 dmg weaken next -10."}]},
    {src:"images/cards/mad toad card format.jpg",name:"Mad Toad",hp:80,attacks:[{name:"Flasher",damage:0,type:"mental",effect:"stun",duration:1,description:"Stun 1 turn."},{name:"Bubble Slam",damage:10,type:"physical",description:"Deal 10 damage."}]}
  ];
  /* ===== STATE ===== */
  let playerHand=[], computerReserve=[], playerSlots=new Array(MAX_SLOTS).fill(null), computerSlots=new Array(MAX_SLOTS).fill(null);
  let selected=null, playerTurn=true, currentActionPanel=null; let playerDiscard=[], computerDiscard=[];
  /* ===== ELEMENTS ===== */
  const playerHandEl=document.getElementById('playerHand');
  const computerHandEl=document.getElementById('computerHand');
  const playerSlotsEl=document.getElementById('playerSlots');
  const computerSlotsEl=document.getElementById('computerSlots');
  const logEl=document.getElementById('battleLog');
  const endTurnBtn=document.getElementById('endTurnBtn');
  const playerGlobalHP=document.getElementById('playerGlobalHP');
  const computerGlobalHP=document.getElementById('computerGlobalHP');
  const turnIndicator=document.getElementById('turnIndicator');
  const playerDiscardCount=document.getElementById('playerDiscardCount');
  const computerDiscardCount=document.getElementById('computerDiscardCount');

  /* ===== HELPERS (NEW) ===== */
  function buildCardHPBar(hp){
    const bar=document.createElement('div'); bar.className='card-hp-bar';
    const wrap=document.createElement('div'); wrap.className='card-hp-segments';
    const fraction=hp/MAX_HP; const show=fraction*SEGMENTS;
    for(let i=0;i<SEGMENTS;i++){ const seg=document.createElement('div'); seg.className='card-hp-seg'; const remain=show-i; if(remain<=0) seg.style.opacity=0.15; else if(remain<1) seg.classList.add('half'); wrap.appendChild(seg);} bar.appendChild(wrap); return bar;
  }
  function updateDiscardUI(){ if(playerDiscardCount) playerDiscardCount.textContent=playerDiscard.length; if(computerDiscardCount) computerDiscardCount.textContent=computerDiscard.length; }
  function handleCardDeath(side, idx){ const slots = side==='player'?playerSlots:computerSlots; const discard= side==='player'?playerDiscard:computerDiscard; const dead=slots[idx]; if(!dead) return; discard.push(dead.card); slots[idx]=null; updateDiscardUI(); renderAll(); checkBattleOver(); }

  /* ===== EXISTING FUNCTIONS (ADAPTED) ===== */
  function loadPlayerInventory(){ let stored=[]; try{ const s=localStorage.getItem('collectedCards'); if(s) stored=JSON.parse(s)||[];}catch{} if(!Array.isArray(stored)||stored.length===0) stored=[...cardPool]; stored=stored.map(c=> cardPool.find(p=>p.name===c.name)||c).slice(0,10); playerHand=stored; }
  function buildComputerReserve(){ const n=playerHand.length; computerReserve=Array.from({length:n},()=>cardPool[Math.floor(Math.random()*cardPool.length)]); }
  function makeSlotsUI(){ playerSlotsEl.innerHTML=''; computerSlotsEl.innerHTML=''; for(let i=0;i<MAX_SLOTS;i++){ const ps=document.createElement('div'); ps.className='slot'; ps.addEventListener('click',()=>onSlotClick('player',i)); playerSlotsEl.appendChild(ps); const cs=document.createElement('div'); cs.className='slot'; cs.addEventListener('click',()=>onSlotClick('computer',i)); computerSlotsEl.appendChild(cs);} }
  function createCardBackEl(){ const el=document.createElement('div'); el.className='card'; el.style.cssText='width:86px;height:120px;cursor:default'; const img=document.createElement('img'); img.src='images/cards/card back.jpeg'; img.alt='Hidden'; img.style.cssText='width:100%;height:100%;object-fit:cover'; el.appendChild(img); const wrap=document.createElement('div'); wrap.style.cssText='width:86px;height:120px'; wrap.appendChild(el); return wrap; }
  function createHandCardEl(card,idx){ const el=document.createElement('div'); el.className='card'; el.style.cssText='width:86px;height:120px'; el.addEventListener('click',()=>onHandClick(idx)); const img=document.createElement('img'); img.src=card.src; img.alt=card.name; img.title=card.name; el.appendChild(img); const wrap=document.createElement('div'); wrap.style.cssText='width:86px;height:120px'; wrap.appendChild(el); return wrap; }
  function renderHand(){ playerHandEl.innerHTML=''; playerHand.forEach((c,i)=>playerHandEl.appendChild(createHandCardEl(c,i))); computerHandEl.innerHTML=''; const remaining=computerReserve.length-computerSlots.filter(s=>s).length; for(let i=0;i<remaining;i++) computerHandEl.appendChild(createCardBackEl()); }
  function onHandClick(i){ hideActionPanel(); clearSelections(); selected={type:'hand',index:i}; document.querySelectorAll('#playerHand .card').forEach((c,idx)=>c.classList.toggle('selected',idx===i)); }
  function onSlotClick(side,idx){ if(side==='player'){ if(selected && selected.type==='hand'){ if(!playerSlots[idx]){ const card=playerHand.splice(selected.index,1)[0]; const cds={}; card.attacks.forEach((a,i)=>{ if(a.effect && ['stun','sleep','poison'].includes(a.effect)) cds[i]=0; }); playerSlots[idx]={card,hp:MAX_HP,defending:false,used:false,statusEffects:[],attackCooldowns:cds}; selected=null; renderAll(); addLog('system',`Placed ${card.name} in slot ${idx+1}`); checkBattleStart(); } } else if(playerSlots[idx] && playerTurn){ hideActionPanel(); showCardActions('player',idx); } } }
  function hasStatusEffect(slot,type){ return !!(slot && slot.statusEffects && slot.statusEffects.some(e=>e.type===type && e.turnsRemaining>0)); }

  function showCardActions(side,idx){ if(side!=='player'||!playerTurn) return; if(turnIndicator.textContent.includes('Setup')) return; const slot=playerSlots[idx]; if(!slot||slot.used) return; if(hasStatusEffect(slot,'stun')||hasStatusEffect(slot,'sleep')){ addLog('system',`${slot.card.name} cannot act due to status!`); return; } hideActionPanel(); clearSelections(); const slotEl=playerSlotsEl.children[idx]; const cardEl=slotEl.querySelector('.card-container .card, .card'); if(cardEl) cardEl.classList.add('selected'); const panel=document.createElement('div'); panel.className='card-action-panel'; const r=slotEl.getBoundingClientRect(); panel.style.left=(r.right+10)+'px'; panel.style.top=r.top+'px'; const target=computerSlots[idx]; const canAttack=target&&target.hp>0; slot.card.attacks.forEach((attack,aIdx)=>{ const onCd=isAttackOnCooldown(slot,aIdx); const cdTurns=getAttackCooldown(slot,aIdx); const disabled=(!canAttack && attack.damage>0)||onCd; const btn=document.createElement('div'); btn.className=`btn ${disabled?'disabled':''} ${onCd?'cooldown':''}`; let t=attack.name; if(attack.damage>0) t+=` (${attack.damage})`; if(attack.effect) t+=` [${attack.effect.toUpperCase()}]`; if(onCd) t+=` (CD:${cdTurns})`; btn.textContent=t; btn.title=attack.description||''; btn.setAttribute('data-description',attack.description||attack.name); if(onCd) btn.setAttribute('data-cooldown',cdTurns); btn.addEventListener('click',()=>{ if(disabled) return; executeAttack(idx,aIdx,attack); }); panel.appendChild(btn); }); const def=document.createElement('div'); def.className='btn'; def.textContent='Defend'; def.addEventListener('click',()=>performDefend(idx)); panel.appendChild(def); if(!canAttack){ const note=document.createElement('div'); note.style.cssText='font-size:8px;color:#aaa;text-align:center;margin-top:4px'; note.textContent='No opposite target'; panel.appendChild(note);} document.body.appendChild(panel); currentActionPanel=panel; }

  function executeAttack(idx,attackIndex,attack){ const slot=playerSlots[idx]; const target=computerSlots[idx]; if(!slot||!target) return; slot.used=true; if(attack.effect && ['stun','sleep','poison'].includes(attack.effect)) slot.attackCooldowns[attackIndex]=3; let dmg=attack.damage||0; if(hasStatusEffect(slot,'weaken')){ dmg=Math.max(0,dmg-10); addLog('system',`${slot.card.name} weakened`);} if(target.defending && dmg>0){ dmg=Math.ceil(dmg/2); target.defending=false; addLog('system',`${target.card.name} defended`);} if(attack.effect) applyStatusEffect(target,attack.effect,attack.duration,slot.card.name); const src=playerSlotsEl.children[idx].querySelector('.card-container .card,.card'); const tgt=computerSlotsEl.children[idx].querySelector('.card-container .card,.card'); if(dmg>0 && src && tgt){ createFlyingProjectile(src,tgt,(ap)=>{ applyDamage('computer',idx,ap,slot.card.name,attack.name); },dmg);} else { addLog('player',`${slot.card.name} uses ${attack.name}`); checkBattleOver(); } hideActionPanel(); renderAll(); }

  function performDefend(idx){ const slot=playerSlots[idx]; if(!slot||slot.used) return; slot.used=true; slot.defending=true; const cardEl=playerSlotsEl.children[idx].querySelector('.card'); if(cardEl){ cardEl.classList.add('defending-anim'); setTimeout(()=>cardEl.classList.remove('defending-anim'),600);} addLog('player',`${slot.card.name} defends`); hideActionPanel(); renderAll(); }

  function applyStatusEffect(target,effect,duration,attacker){ if(!effect||!duration) return; if(!target.statusEffects) target.statusEffects=[]; target.statusEffects.push({type:effect,duration,turnsRemaining:duration,attacker,justApplied:true}); const msgs={stun:`${target.card.name} is stunned!`,sleep:`${target.card.name} falls asleep!`,poison:`${target.card.name} is poisoned (${duration})!`,weaken:`${target.card.name} is weakened!`}; if(msgs[effect]) addLog('system',msgs[effect]); }

  function processStatusEffects(side){ const slots= side==='player'?playerSlots:computerSlots; const slotsEl= side==='player'?playerSlotsEl:computerSlotsEl; slots.forEach((s,i)=>{ if(!s||!s.statusEffects) return; s.statusEffects=s.statusEffects.filter(e=>{ if(e.justApplied){ e.justApplied=false; return true;} if(e.type==='poison'){ const dmg=5; s.hp=Math.max(0,s.hp-dmg); addLog('system',`${s.card.name} takes ${dmg} poison`); const el=slotsEl.children[i]; if(el) showDamagePopup(el,dmg,'#8B4513'); if(s.hp<=0){ setTimeout(()=>{ const c=slotsEl.children[i].querySelector('.card'); if(c) c.classList.add('die'); setTimeout(()=>handleCardDeath(side,i),600); },400); return false;} } e.turnsRemaining--; if(e.turnsRemaining<=0) return false; return true; }); if(s && s.hp>0) updateSlotUI(side,i); }); renderAll(); }

  function createFlyingProjectile(from,to,cb,damage){ const clone=from.cloneNode(true); const fr=from.getBoundingClientRect(); const tr=to.getBoundingClientRect(); clone.style.cssText='position:fixed;left:'+fr.left+'px;top:'+fr.top+'px;pointer-events:none;z-index:2000;transition:transform .8s ease,opacity .8s'; document.body.appendChild(clone); const dx=tr.left-fr.left, dy=tr.top-fr.top; requestAnimationFrame(()=>{ clone.style.transform=`translate(${dx}px,${dy}px) scale(.8) rotate(360deg)`; clone.style.opacity='0'; }); setTimeout(()=>{ clone.remove(); if(cb) cb(damage); },800); }

  function makeBattleCardEl(slotObj,owner,idx){ const cont=document.createElement('div'); cont.className='card-container'; const card=document.createElement('div'); card.className=`card ${slotObj.used?'used':''}`; card.style.width='86px'; card.style.height='120px'; const img=document.createElement('img'); img.src=slotObj.card.src; img.alt=slotObj.card.name; img.title=slotObj.card.name; card.appendChild(img); cont.appendChild(card); const hp=buildCardHPBar(slotObj.hp); cont.appendChild(hp); cont._hpBar=hp; cont.dataset.owner=owner; cont.dataset.slot=idx; return cont; }

  function updateSlotUI(side,idx){ const slots= side==='player'?playerSlots:computerSlots; const slotsEl= side==='player'?playerSlotsEl:computerSlotsEl; const slot=slots[idx]; const slotEl=slotsEl.children[idx]; if(slot && slotEl.firstChild){ const cont=slotEl.firstChild; if(cont._hpBar) cont._hpBar.remove(); const bar=buildCardHPBar(slot.hp); cont.appendChild(bar); cont._hpBar=bar; } updateGlobalHPUI(); }

  function renderAll(){ for(let i=0;i<MAX_SLOTS;i++){ const p=playerSlotsEl.children[i]; p.innerHTML=''; p.classList.remove('occupied'); if(playerSlots[i]){ p.classList.add('occupied'); p.appendChild(makeBattleCardEl(playerSlots[i],'player',i)); } const c=computerSlotsEl.children[i]; c.innerHTML=''; c.classList.remove('occupied'); if(computerSlots[i]){ c.classList.add('occupied'); c.appendChild(makeBattleCardEl(computerSlots[i],'computer',i)); } } renderHand(); updateGlobalHPUI(); }

  function updateGlobalHPUI(){ const sumP=playerSlots.reduce((s,a)=>s+(a?a.hp:0),0); const sumC=computerSlots.reduce((s,a)=>s+(a?a.hp:0),0); playerGlobalHP.innerHTML=''; computerGlobalHP.innerHTML=''; const total=MAX_SLOTS*MAX_HP; renderSegments(playerGlobalHP,sumP/total); renderSegments(computerGlobalHP,sumC/total); }
  function renderSegments(container,fraction){ const show=fraction*SEGMENTS; for(let i=0;i<SEGMENTS;i++){ const seg=document.createElement('div'); seg.className='seg'; const remain=show-i; if(remain<=0) seg.style.opacity=.12; else if(remain<1) seg.classList.add('half'); container.appendChild(seg);} }

  function showDamagePopup(container,dmg,color){ const pop=document.createElement('div'); pop.className='dmg-pop'; pop.style.color=color||'#ff4444'; pop.textContent='-'+dmg; pop.style.left='50%'; pop.style.top='10%'; container.style.position='relative'; container.appendChild(pop); setTimeout(()=>pop.remove(),1000); }

  function applyDamage(side,idx,amount,attackerName,attackName){ const slots=side==='computer'?computerSlots:playerSlots; const slot=slots[idx]; if(!slot) return; slot.hp=Math.max(0,slot.hp-amount); addLog(attackerName? (side==='computer'?'player':'computer') : 'system', `${attackerName||'Card'} uses ${attackName||'attack'} for ${amount}`); if(slot.hp<=0){ const el=(side==='computer'?computerSlotsEl:playerSlotsEl).children[idx]; const c=el.querySelector('.card'); if(c) c.classList.add('die'); setTimeout(()=>handleCardDeath(side==='computer'?'computer':'player',idx),600); } else updateSlotUI(side==='computer'?'computer':'player',idx); }

  function addLog(type,text){ const div=document.createElement('div'); div.className='entry '+(type==='player'?'player':type==='computer'?'computer':'system'); div.textContent=text; div.setAttribute('data-time', new Date().toLocaleTimeString()); logEl.appendChild(div); logEl.scrollTop=logEl.scrollHeight; }
  function hideActionPanel(){ if(currentActionPanel){ currentActionPanel.remove(); currentActionPanel=null; } }
  function clearSelections(){ document.querySelectorAll('.card.selected').forEach(c=>c.classList.remove('selected')); selected=null; }

  function isAttackOnCooldown(slot,i){ return slot.attackCooldowns && slot.attackCooldowns[i]>0; }
  function getAttackCooldown(slot,i){ return (slot.attackCooldowns && slot.attackCooldowns[i])||0; }

  function computerPlaceCard(){ const empty=[]; for(let i=0;i<MAX_SLOTS;i++) if(!computerSlots[i]) empty.push(i); if(!empty.length) return false; const placed=computerSlots.filter(s=>s).length; if(placed>=computerReserve.length) return false; const playerOcc=playerSlots.map((s,i)=>s&&s.hp>0?i:-1).filter(i=>i>-1); const good=empty.filter(i=>playerOcc.includes(i)); const target=good.length? good[Math.floor(Math.random()*good.length)] : empty[Math.floor(Math.random()*empty.length)]; const card=computerReserve[placed]; const cds={}; card.attacks.forEach((a,i)=>{ if(a.effect && ['stun','sleep','poison'].includes(a.effect)) cds[i]=0; }); computerSlots[target]={card,hp:MAX_HP,defending:false,used:false,statusEffects:[],attackCooldowns:cds}; renderAll(); addLog('computer',`Computer placed ${card.name} in slot ${target+1}`); return true; }

  function computerInitialPlacement(){ const empty=[]; for(let i=0;i<MAX_SLOTS;i++) if(!computerSlots[i]) empty.push(i); const playerOcc=playerSlots.map((s,i)=>s?i:-1).filter(i=>i>-1); const toPlace=Math.min(Math.max(1,playerOcc.length),3,computerReserve.length); const priority=playerOcc.filter(i=>empty.includes(i)); const remaining=empty.filter(i=>!priority.includes(i)); const targets=[...priority,...remaining].slice(0,toPlace); targets.forEach((slotIdx,i)=>{ const card=computerReserve[i]; if(!card) return; const cds={}; card.attacks.forEach((a,j)=>{ if(a.effect && ['stun','sleep','poison'].includes(a.effect)) cds[j]=0; }); computerSlots[slotIdx]={card,hp:MAX_HP,defending:false,used:false,statusEffects:[],attackCooldowns:cds}; }); renderAll(); addLog('system',`Computer placed ${targets.length} cards strategically.`); }

  function computerAttack(i){ const attacker=computerSlots[i]; const target=playerSlots[i]; if(!attacker||!target) return; attacker.used=true; const attacks=attacker.card.attacks||[]; const atk=attacks.length? attacks[Math.floor(Math.random()*attacks.length)] : {name:'Basic',damage:5}; if(atk.effect && ['stun','sleep','poison'].includes(atk.effect)){ const idx=attacks.findIndex(a=>a.name===atk.name); if(idx>-1) attacker.attackCooldowns[idx]=3; } let dmg=atk.damage||0; if(hasStatusEffect(attacker,'weaken')){ dmg=Math.max(0,dmg-10); addLog('system',`${attacker.card.name} weakened`);} if(target.defending && dmg>0){ dmg=Math.ceil(dmg/2); target.defending=false; addLog('system',`${target.card.name} defended`);} if(atk.effect) applyStatusEffect(target,atk.effect,atk.duration,attacker.card.name); const aEl=computerSlotsEl.children[i].querySelector('.card'); const tEl=playerSlotsEl.children[i].querySelector('.card'); if(dmg>0 && aEl && tEl){ createFlyingProjectile(aEl,tEl,(ap)=>applyDamage('player',i,ap,attacker.card.name,atk.name),dmg);} else { addLog('computer',`${attacker.card.name} uses ${atk.name}`); } }
  function computerDefend(i){ const slot=computerSlots[i]; if(!slot) return; slot.used=true; slot.defending=true; const c=computerSlotsEl.children[i].querySelector('.card'); if(c){ c.classList.add('defending-anim'); setTimeout(()=>c.classList.remove('defending-anim'),600);} addLog('computer',`${slot.card.name} defends`); }

  function performComputerActions(){ const active=computerSlots.map((s,i)=>{ if(!s||s.used||s.hp<=0) return -1; if(hasStatusEffect(s,'stun')||hasStatusEffect(s,'sleep')) return -1; return i; }).filter(i=>i>-1); if(!active.length){ addLog('system','Computer passes'); return endComputerTurn(); } const idx=active[Math.floor(Math.random()*active.length)]; const target=playerSlots[idx]; const canAttack=target&&target.hp>0; const maybePlace=Math.random()<0.4 && computerSlots.filter(s=>s).length<4; if(maybePlace && computerPlaceCard()) return setTimeout(()=>performComputerActions(),900); if(canAttack && Math.random()>0.3) computerAttack(idx); else computerDefend(idx); setTimeout(()=>{ const more=computerSlots.some(s=>s && !s.used && s.hp>0 && !hasStatusEffect(s,'stun') && !hasStatusEffect(s,'sleep')); if(more) performComputerActions(); else endComputerTurn(); },1100); }

  function computerTurn(){ if(turnIndicator.textContent.includes('Setup')) return; turnIndicator.textContent='Computer Turn'; endTurnBtn.classList.add('disabled'); addLog('system','Computer thinking...'); setTimeout(()=>{ processStatusEffects('computer'); computerSlots.forEach(s=>{ if(s){ s.used=false; s.defending=false; if(s.attackCooldowns){ Object.keys(s.attackCooldowns).forEach(k=>{ if(s.attackCooldowns[k]>0) s.attackCooldowns[k]--; }); } } }); setTimeout(()=>performComputerActions(),400); },600); }
  function endComputerTurn(){ playerTurn=true; turnIndicator.textContent='Player Turn'; endTurnBtn.classList.remove('disabled'); processStatusEffects('player'); playerSlots.forEach(s=>{ if(s){ s.used=false; s.defending=false; if(s.attackCooldowns){ Object.keys(s.attackCooldowns).forEach(k=>{ if(s.attackCooldowns[k]>0){ s.attackCooldowns[k]--; if(s.attackCooldowns[k]===0) addLog('system',`${s.card.attacks[+k].name} ready`); } }); } } }); addLog('system','Player turn begins'); renderAll(); }

  function checkBattleStart(){ const has=playerSlots.some(s=>s); if(has && turnIndicator.textContent.includes('Setup')){ addLog('system','Computer is ready to battle...'); computerInitialPlacement(); setTimeout(()=>{ const first=Math.random()<0.5; if(first){ turnIndicator.textContent='Player Turn'; playerTurn=true; endTurnBtn.classList.remove('disabled'); addLog('system','Battle begins! Player first.'); } else { turnIndicator.textContent='Computer Turn'; playerTurn=false; endTurnBtn.classList.add('disabled'); addLog('system','Battle begins! Computer first.'); setTimeout(()=>computerTurn(),800); } },1300);} }

  function checkBattleOver(){ const pAlive=playerSlots.some(s=>s&&s.hp>0); const cAlive=computerSlots.some(s=>s&&s.hp>0); if(!pAlive||!cAlive){ const res=cAlive?'defeat':'victory'; addLog('system',`Battle over: ${res.toUpperCase()}`); setTimeout(()=>alert(res==='victory'? 'You won!' : 'You lost!'),400); } }

  endTurnBtn.addEventListener('click',()=>{ if(!playerTurn||endTurnBtn.classList.contains('disabled')) return; hideActionPanel(); clearSelections(); playerTurn=false; addLog('system','Player ended turn.'); if(!turnIndicator.textContent.includes('Setup')) setTimeout(()=>computerTurn(),500); });
  document.addEventListener('click',e=>{ if(currentActionPanel && !currentActionPanel.contains(e.target) && !e.target.closest('.slot') && !e.target.closest('.card')){ hideActionPanel(); clearSelections(); } });
  document.addEventListener('keydown',e=>{ if(e.key==='Escape'){ hideActionPanel(); clearSelections(); } if((e.key===' '||e.key==='Enter') && playerTurn && !endTurnBtn.classList.contains('disabled')){ endTurnBtn.click(); e.preventDefault(); } });

  function decideFirstPlayer(){ playerTurn=true; turnIndicator.textContent='Player Setup Phase'; endTurnBtn.classList.add('disabled'); addLog('system','Place your cards on the battlefield first.'); }
  function fillComputerSlots(){ computerSlots.fill(null); }

  function init(){ makeSlotsUI(); loadPlayerInventory(); buildComputerReserve(); fillComputerSlots(); renderAll(); decideFirstPlayer(); addLog('system','Place cards by clicking a hand card then a player slot.'); addLog('system','Battle begins after your first placement.'); updateDiscardUI(); }

  window._debug={playerSlots,computerSlots,playerHand,computerReserve};
  init();
})();
</script>
</body>
</html>
